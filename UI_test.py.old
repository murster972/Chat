#!/usr/bin/env python3
import os
import urwid

class UI:
	def __init__(self):
		palette = [("bg", "black", "white"), ("txt_display", "black", "white"), ("button", "white", "black")]
		self.message = "Messages: "
		self.input = ""

		self.txt = urwid.Text(("txt_display", self.message))
		txt_map = urwid.AttrMap(self.txt, "txt_display")
		lst_walker = urwid.SimpleListWalker([txt_map])
		lst_box = urwid.ListBox(lst_walker)
		lst_box_map = urwid.AttrMap(lst_box, "txt_display")

		butn_div = urwid.Divider()
		butn_div_map = urwid.AttrMap(butn_div, "button")
		
		butn3 = urwid.Button(("button", "Exit"))
		butn3_map = urwid.AttrMap(butn3, "button")
		butn3_pad = urwid.Padding(butn3_map, left=1)

		butn = urwid.Button(("button", "Active Users"))
		butn_map = urwid.AttrMap(butn, "button")
		butn_pad = urwid.Padding(butn_map, right=1)

		butn2 = urwid.Button(("button", "Close Connection"))
		butn2_map = urwid.AttrMap(butn2, "button")
		butn2_pad = urwid.Padding(butn2_map, left=1, right=1)

		cols = urwid.Columns([butn_pad, butn2_pad, butn3_pad])

		self.inpt = urwid.Edit(("button", "Message: "))
		inpt_map = urwid.AttrMap(self.inpt, "button")

		div = urwid.Divider()
		div_map = urwid.AttrMap(div, "txt_display")

		send_butn = urwid.Button(("button", "Send"))
		send_butn_map = urwid.AttrMap(send_butn, "button")

		#send_butn_pile = urwid.Pile([butn_div_map, send_butn_map, butn_div_map])

		#inpt_col = urwid.Columns([inpt_map, send_butn_map])

		pile = urwid.Pile([div_map, lst_box, inpt_map, div_map, send_butn_map ,div_map, butn_map, butn2_map, butn3_map])
		#pile = urwid.Pile([lst_box])
		
		# = urwid.Filler(pile)
		#fill_map = urwid.AttrMap(fill, "bg")

		pad = urwid.Padding(pile, left=20, right=20)
		pad_map = urwid.AttrMap(pad, "bg")

		urwid.connect_signal(butn3, "click", self.on_click)
		urwid.connect_signal(self.inpt, "change", self.on_change)
		#figure out how to get inpt click signal to work
		urwid.connect_signal(send_butn, "click", self.send)

		loop = urwid.MainLoop(pad_map, palette)
		loop.run()

	def on_change(self, inpt, inpt_txt):
		self.input = inpt_txt

	def send(self, butn):
		self.message += self.input + "\n"
		self.txt.set_text(self.message)
		self.inpt.set_edit_text("")

	def tst(self, inpt, text):
		self.txt.set_text("Test")
		#raise urwid.ExitMainLoop()

	def on_click(self, butn):
		raise urwid.ExitMainLoop()

if __name__ == '__main__':
	UI()